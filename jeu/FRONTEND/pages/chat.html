<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat en Temps Réel</title>
    <link rel="stylesheet" href="../css/chat.css">
 </head>
<body>
    <div class="navbar">
        <div>
            <a href="#" class="logo"><img src="../img/logo.png" alt="" class="logoimg"></a>
        </div>
        <div class="right">
            <a href="description.html">Description</a>
            <a href="chat.html">Chat général</a>
            <a href="jeu.php">Le Jeu</a>
            <a href="classement.php">Classement</a>
            <div class="droite">
                <a href="profil.php">Profil <img src="../img/3135715.png" alt="Profil"></a>
                <a href="../index.php"><img src="../img/53494.png" alt=""></a>
            </div>
        </div>
        <div class="menu-toggle">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>
<div class="chat-container">
    <div class="messages" id="messages"></div>
    <div class="input-container">
        <input type="text" id="messageInput" placeholder="Tapez votre message...">
        <button onclick="sendMessage()">Envoyer</button>
    </div>
</div>


<script>
    function fetchMessages() {
        fetch('../../BACKEND/php/get_messages.php')
            .then(response => response.json())
            .then(data => {
                const messagesContainer = document.getElementById('messages');
                messagesContainer.innerHTML = '';
                data.forEach(message => {
                    const messageElement = document.createElement('div');
                    messageElement.classList.add('message');
                    messageElement.innerHTML = `<span>${message.username}:</span> ${message.message} <small>${message.timestamp}</small>`;
                    messagesContainer.appendChild(messageElement);
                });
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            })
            .catch(error => console.error('Error fetching messages:', error));
    }

    function sendMessage() {
        const messageInput = document.getElementById('messageInput');
        const message = messageInput.value;

        if (message.trim() === '') return;

        fetch('../../BACKEND/php/post_message.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: `message=${encodeURIComponent(message)}`
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                messageInput.value = '';
                fetchMessages();
            } else {
                alert(data.message);
            }
        })
        .catch(error => console.error('Error sending message:', error));
    }

    // Rafraîchir les messages toutes les 2 secondes
    setInterval(fetchMessages, 2000);
    fetchMessages(); // Récupérer les messages au chargement de la page
</script>

</body>
</html>
